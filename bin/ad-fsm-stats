#!/usr/bin/env ruby
# encoding: UTF-8

require_relative '../lib/art-decomp'
require 'trollop'

$stdout.sync = true

opts = Trollop.options ARGV do
  opt :archs, 'Target architecture(s)', type: :strings
end
Trollop.die :archs, 'not given' unless opts[:archs_given]
archs = opts[:archs].map { |s| ArtDecomp::Arch[*s.split('/').map(&:to_i)] }.to_set

ARGV.each do |fsm_file|
  fsm = ArtDecomp::FSM.from_kiss fsm_file
  puts "#{File.basename fsm_file}:\t#{fsm.stats} = #{fsm.input_count + fsm.beta_q.pins}/#{fsm.output_count + fsm.beta_q.pins} #{"implementable in #{fsm.fsm_cells archs}" if fsm.implementable_in? archs}"
end
