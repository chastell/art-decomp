require_relative '../spec_helper'

module ArtDecomp describe Decomposer do
  describe '#decompositions' do
    it 'yields the Decompositions generated by the generators' do
      archs, fsm, u, v, qu, qv, g = *Array.new(7) { Object.new }
      gens = {
        uv: [MiniTest::Mock.new.expect(:uv_pairs, [[fsm, u, v]], [fsm, archs])],
        qu: [MiniTest::Mock.new.expect(:blankets, [qu],          [fsm, u, v])],
        qv: [MiniTest::Mock.new.expect(:blankets, [[qv, g]],     [fsm, u, v, qu])],
      }
      decomposer = Decomposer.new
      decomposer.config = { archs: archs, fsm: fsm, gens: gens }
      decomposer.decompositions.must_include Decomposition.new fsm, u, v, qu, qv, g
      gens.values.each { |gs| gs.map(&:verify) }
    end
  end
end end
